<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Waste Sorter (O/I/E) - Web + Arduino</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header class="bar">
    <h1>فرز النفايات (Organic / Inorganic / Empty)</h1>
    <div class="row">
      <button id="btnStart">تشغيل الكاميرا</button>
      <button id="btnConnect" disabled>ربط Arduino (Web Serial)</button>
      <button id="btnStop" disabled>إيقاف</button>
    </div>
  </header>

  <main class="grid">
    <section class="card">
      <h2>الكاميرا</h2>
      <div class="videoWrap">
        <video id="video" playsinline autoplay muted></video>
        <canvas id="overlay"></canvas>
      </div>
      <div class="small">
        ملاحظة: لازم تفتح الموقع من <b>https</b> أو من <b>localhost</b> حتى تشتغل الكاميرا و WebSerial.
      </div>
    </section>

    <section class="card">
      <h2>النتيجة</h2>
      <div class="kv">
        <div>Object label:</div><div id="objLabel">-</div>
        <div>Confidence:</div><div id="objConf">-</div>
        <div>Decision:</div><div id="decision" class="pill">-</div>
        <div>Sent to Arduino:</div><div id="sent">-</div>
      </div>

      <hr/>

      <h3>الإعدادات</h3>
      <div class="controls">
        <label>Threshold كشف الجسم:
          <input id="detThr" type="range" min="0.30" max="0.90" step="0.01" value="0.60" />
          <span id="detThrVal">0.60</span>
        </label>

        <label>Stability frames (تثبيت القرار):
          <input id="stableN" type="number" min="3" max="30" value="10" />
        </label>

        <label>Send cooldown (ms):
          <input id="cooldown" type="number" min="100" max="5000" value="600" />
        </label>

        <label>
          <input id="unknownAsInorg" type="checkbox" checked />
          اعتبر الأشياء غير المعروفة = Inorganic
        </label>

        <details>
          <summary>خريطة التصنيف (ممكن تعدلها)</summary>
          <p class="small">نستخدم نموذج جاهز للكشف (COCO-SSD). بعد ما يعطينا "label" نحوله إلى O/I/E. عدّل القوائم في <code>app.js</code> إذا حبيت.</p>
        </details>
      </div>

      <hr/>

      <h3>التعليمات السريعة</h3>
      <ol class="small">
        <li>شغّل الموقع على سيرفر (مثلاً: <code>python -m http.server 8000</code>) وافتح <code>http://localhost:8000</code>.</li>
        <li>اضغط <b>تشغيل الكاميرا</b> ثم <b>ربط Arduino</b>.</li>
        <li>إذا ما في شيء أمام الكاميرا: يرسل <b>E</b>. عضوي: <b>O</b>. غير عضوي: <b>I</b>.</li>
      </ol>
    </section>
  </main>

  <!-- TensorFlow.js + COCO-SSD (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.18.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3"></script>
  <script type="module" src="./app.js"></script>
</body>
</html>
